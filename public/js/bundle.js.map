{"mappings":"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","sources":["public/js/index.js","public/js/mapbox.js","public/js/login.js","public/js/alerts.js","public/js/updateSettings.js","public/js/stripe.js"],"sourcesContent":["import { displayMap } from './mapbox';\r\nimport { login, logout } from './login';\r\nimport { updateSettings } from './updateSettings';\r\nimport { bookTour } from './stripe';\r\n\r\n// DOM ELEMENTS\r\nconst mapBox = document.getElementById('map');\r\nconst loginForm = document.querySelector('.form--login');\r\nconst logOutButton = document.querySelector('.nav__el--logout');\r\nconst userDataForm = document.querySelector('.form-user-data');\r\nconst userPasswordForm = document.querySelector('.form-user-settings');\r\nconst bookBtn = document.getElementById('book-tour');\r\n// VALUES\r\n\r\n//DELEGATION\r\nif (mapBox) {\r\n  const locations = JSON.parse(mapBox.dataset.locations);\r\n  displayMap(locations);\r\n}\r\n\r\nif (loginForm) {\r\n  loginForm.addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n\r\n    const email = document.getElementById('email').value;\r\n    const password = document.getElementById('password').value;\r\n    login(email, password);\r\n  });\r\n}\r\n\r\nif (logOutButton) {\r\n  logOutButton.addEventListener('click', logout);\r\n}\r\n\r\nif (userDataForm) {\r\n  userDataForm.addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    // to create mulitpart for data\r\n    const form = new FormData();\r\n    form.append('name', document.getElementById('name').value);\r\n    form.append('email', document.getElementById('email').value);\r\n    form.append('photo', document.getElementById('photo').files[0]);\r\n\r\n    // if not using multipart form data, can just pass in object\r\n    // const data = {\r\n    //   name: document.getElementById('name').value,\r\n    //   email: document.getElementById('email').value,\r\n    // };\r\n    updateSettings(form, 'data');\r\n  });\r\n}\r\n\r\nif (userPasswordForm) {\r\n  userPasswordForm.addEventListener('submit', async (e) => {\r\n    e.preventDefault();\r\n    document.querySelector('.btn--save-password').textContent = 'Updating...';\r\n    const passwordCurrent = document.getElementById('password-current');\r\n    const password = document.getElementById('password');\r\n    const passwordConfirm = document.getElementById('password-confirm');\r\n\r\n    const data = {\r\n      passwordCurrent: passwordCurrent.value,\r\n      password: password.value,\r\n      passwordConfirm: passwordConfirm.value,\r\n    };\r\n    await updateSettings(data, 'password');\r\n\r\n    document.querySelector('.btn--save-password').textContent = 'Save password';\r\n\r\n    passwordCurrent.value = '';\r\n    password.value = '';\r\n    passwordConfirm.value = '';\r\n  });\r\n}\r\n\r\nif (bookBtn) {\r\n  bookBtn.addEventListener('click', (e) => {\r\n    e.target.textContent = 'proccessing...';\r\n    const { tourId } = e.target.dataset;\r\n\r\n    bookTour(tourId);\r\n  });\r\n}\r\n","export const displayMap = (locations) => {\r\n  mapboxgl.accessToken =\r\n    'pk.eyJ1IjoicnltZWxhIiwiYSI6ImNsZ2o2Zjd0YjAwZm8zZ3FzNzJ2a3g2MnoifQ.MlfIu_7sSZezmGYUs02ZPQ';\r\n\r\n  // 2) Define new map\r\n  const map = new mapboxgl.Map({\r\n    container: 'map', // container ID\r\n    style: 'mapbox://styles/rymela/clgj89h3z006z01qx9e128675', // style URL\r\n    scrollZoom: false,\r\n    // maxZoom: 10,\r\n    // center: [-122.29286, 38.294065], // starting position [lng, lat]\r\n    // zoom: 5, // starting zoom\r\n    // interactive: false,\r\n  });\r\n\r\n  // 3) Create bounds object\r\n  const bounds = new mapboxgl.LngLatBounds();\r\n\r\n  // 4) Create markers for all locations\r\n  locations.forEach((loc) => {\r\n    // 1) Create marker\r\n    const el = document.createElement('div');\r\n    el.className = 'marker';\r\n\r\n    // 2) Add marker\r\n    new mapboxgl.Marker({\r\n      element: el,\r\n      // bottom of el (pin) will be placed on the location\r\n      anchor: 'bottom',\r\n    })\r\n      .setLngLat(loc.coordinates)\r\n      .addTo(map);\r\n\r\n    // 3) Add label\r\n    new mapboxgl.Popup({\r\n      offset: 30,\r\n    })\r\n      .setLngLat(loc.coordinates)\r\n      .setHTML(`<p>Day ${loc.day}: ${loc.description}</p>`)\r\n      .addTo(map);\r\n\r\n    // 4) extend map bounds to include the current location\r\n    bounds.extend(loc.coordinates);\r\n  });\r\n\r\n  // 5) Fit map to bounds and add padding\r\n  map.fitBounds(bounds, {\r\n    padding: {\r\n      top: 200,\r\n      bottom: 150,\r\n      left: 100,\r\n      right: 100,\r\n    },\r\n  });\r\n\r\n  // 6) Add zoom controls\r\n\r\n  const controls = new mapboxgl.NavigationControl();\r\n  map.addControl(controls, 'bottom-left');\r\n};\r\n","import { showAlert } from './alerts';\r\n\r\nexport const login = async (email, password) => {\r\n  try {\r\n    const res = await fetch('http://127.0.0.1:8000/api/v1/users/login', {\r\n      method: 'POST',\r\n      headers: {\r\n        'content-type': 'application/json; charset=UTF-8',\r\n      },\r\n      body: JSON.stringify({\r\n        email,\r\n        password,\r\n      }),\r\n    });\r\n    const data = await res.json();\r\n\r\n    if (res.ok) {\r\n      showAlert('success', 'Logged in successfully!');\r\n      window.setTimeout(() => {\r\n        location.assign('/');\r\n      }, 1500);\r\n    } else throw new Error(data.message);\r\n  } catch (error) {\r\n    showAlert('error', error.message);\r\n  }\r\n};\r\n\r\nexport const logout = async () => {\r\n  try {\r\n    const res = await fetch('http://127.0.0.1:8000/api/v1/users/logout');\r\n    const data = await res.json();\r\n\r\n    if (res.ok) {\r\n      showAlert('success', 'Logged out successfully!');\r\n      // \"true\" forces reload from server and not just from browseer cache!\r\n      window.setTimeout(() => {\r\n        location.assign('/');\r\n      }, 1500);\r\n    } else throw new Error(data.message);\r\n  } catch (error) {\r\n    showAlert('error', error.message ?? 'Error logging out');\r\n  }\r\n};\r\n","export const hideAlert = () => {\r\n  const el = document.querySelector('.alert');\r\n  if (el) el.parentElement.removeChild(el);\r\n};\r\n\r\n// type is res.ok:  true|false\r\nexport const showAlert = (type, msg) => {\r\n  hideAlert();\r\n  const markup = `\r\n    <div class=\"alert alert--${type}\">${msg}</div>\r\n  `;\r\n  document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\r\n  window.setTimeout(hideAlert, 5000);\r\n};\r\n","import { showAlert } from './alerts';\r\n\r\n// type= 'password' || 'data\r\nexport const updateSettings = async (data, type) => {\r\n  // when sending formData with fetch(), no contenet-type or JSON.stringify\r\n  const url =\r\n    type === 'password'\r\n      ? `http://127.0.0.1:8000/api/v1/users/updateMyPassword`\r\n      : `http://127.0.0.1:8000/api/v1/users/updateMe`;\r\n  const options = {\r\n    method: 'PATCH',\r\n    body: data,\r\n  };\r\n\r\n  try {\r\n    const res = await fetch(url, options);\r\n    // const data = await res.json();\r\n\r\n    if (res.ok) {\r\n      showAlert('success', `${type.toUpperCase()} updated successfully!`);\r\n    }\r\n    if (!res.ok)\r\n      throw new Error(\r\n        'There was a problem updating your information.  Try again later!'\r\n      );\r\n  } catch (error) {\r\n    console.log(error);\r\n    showAlert('error', error.message);\r\n  }\r\n};\r\n","import { showAlert } from './alerts';\r\n\r\nexport const bookTour = async (tourId) => {\r\n  const stripe = Stripe(\r\n    'pk_test_51MxxFoCyE3KlvgqvKGO9m3AGRmxIkBqFh1nLOX9v8ec1KDNNuL1sdkmQPClFUF0HElHky0vaormgDixvP4MCOVyL00gUtsQ6In'\r\n  );\r\n\r\n  try {\r\n    // 1) get session from API\r\n    const res = await fetch(\r\n      `http://127.0.0.1:8000/api/v1/bookings/checkout-session/${tourId}`\r\n    );\r\n    const session = await res.json();\r\n    // 2) Create checkout form and charge credit card\r\n    await stripe.redirectToCheckout({\r\n      sessionId: session.session.id,\r\n    });\r\n  } catch (error) {\r\n    console.log(error);\r\n    showAlert('error', err.message);\r\n  }\r\n};\r\n"],"names":[],"version":3,"file":"bundle.js.map","sourceRoot":"../../"}